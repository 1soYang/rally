- secret:
    name: rally-dockerhub-credentials
    data:
      username: !encrypted/pkcs1-oaep
        - IOewkAChKmlkgrYeX+Lk+sjpGj99dswA6b0vXQBio0dUngRspAtXR3VJAxyZAyYwXbUPU
          HHq7qHDlesVfBl/RCPVfbFt4+79L7h4NSCo2NIR3DPKIVIXBfVGsmHvRglY3c6E+ji2Bm
          VOk/jsEW+b+k+SZy6rQ4J35HGVBJUzyJzVB7l/2lJ3Wmf0b2MyTBz3tApK8+dP+GAa6Hd
          UTY6140pxTPS010kit7/8s5B2zlt/ky3raTjclLuCmQHR5J98/7Mxd02HYjz71VSmDOjZ
          d0fWYGVLQb0XxcdaLHYNYQhY0BIq3qa0p9diavz131OzJ5maQI0RKDXcz0BTsBP6bQfcM
          etdB7L9geqTjIoA8dlJgM4ZQNer5UFrfeOTf8XpjPtM+U03T9GE4wKtEu1S8iinN9CB/g
          dQdcrel9V0HkKBvJTJdlHFngp4lGx2JG+sDGIIgUru2GH4mi3fndAkqth/m22SgDq14TG
          Zksbd3pBtoirt93H1hk557EM1FbfNpxGXkIo4No+LzuCuDymDga2ntHF2EcuGGUDlE+Pn
          vmEvD4/dkXyyNJAqaHhwnTHy8clTYu0xEwTDvUL+Ss86McIxotw6Vv0XPeL1JUB0Ewfdu
          QG3mgGXWqnoaixZpxjtLnmvA/syB5BEj9qcw4aXfU0ACytTU5H+pGHiwah0ST0=
      password: !encrypted/pkcs1-oaep
        - VU7F2XHpVSvqfco6B6F3iXhTdy1/5Rv+8UiT/Sk2SuQd+ZHLV2mVSncdYQRpuAt3/z3Al
          1BaoCFBYXPiaGOb1zW2s6kvwhn9jWOWHc20M2QAWMia45HNfS9qtMsBW4djlFFW4TTsSy
          zCZXor3ulVhlBaLOKGrhjWTBi/EDCslLJEH4quOjmP5/RXqph7Z62RyueSbm6F1+JcWgE
          zI+nJ+X7q4winKrAndSkP7lDr3IU1OK8gmPwfvPO4Tvwrec6RMWb5DlICp9YDP/H35Fb9
          PdR+aapd++UOxsZPKc0nUroxjmENpOcqrIYuwtS7oAitoK3QuAsQ/M8d6WHwmoa4/I6DB
          rBDEJV9goxu9qAzYLNKiqsV/IIcpud52j9HVlKLTvqeAN7qCSqxlhVlS8lXCmYhiNrscy
          LTa+uM+6EKQC46eFaYos/2bChKR1c6wya2Y1Dj0Qj27CgQtp+WiAHTT+NgxGo7d3Jqk2z
          UakGoIOovwcV7HpfFHQDijDBz/+6DR4iD+MSbOrG2QRzrjSix9kSk2b7t2liUZ0ODEPWe
          DvlbYngfxXRzxdh/lxQ8AvCXtdRQNYrahyhhCsruBtQTptUgjxnPRe/tZyYAAKXILadZM
          1cA3UecdfuFWhah/ffS1wWC0TvP+UPcJ/dNw3Xlurjt2USJfdyw0MueN7Wsj3Q=

- job:
    name: rally-install-base
    parent: base
    pre-run: tests/ci/playbooks/rally-install-pre.yaml
    run: tests/ci/playbooks/rally-install-run.yaml
    post-run: tests/ci/playbooks/fetch-html-and-json-reports.yaml
    timeout: 1800

- job:
    name: rally-install-ubuntu-bionic
    parent: rally-install-base
    nodeset: ubuntu-bionic

- job:
    name: rally-install-centos-7
    parent: rally-install-base
    nodeset: centos-7

- job:
    name: rally-install-centos-8
    parent: rally-install-base
    nodeset: centos-8

- job:
    name: rally-docker-build
    parent: build-docker-image
    nodeset: ubuntu-bionic
    run: tests/ci/playbooks/build-and-check-docker-image.yaml
    post-run: tests/ci/playbooks/fetch-html-and-json-reports.yaml
    timeout: 1800

- job:
    name: rally-docker-build-and-push
    parent: build-docker-image
    nodeset: ubuntu-bionic
    run: tests/ci/playbooks/build-check-and-push-docker-image.yaml
    post-run: tests/ci/playbooks/fetch-html-and-json-reports.yaml
    timeout: 1800
    secrets:
      name: docker_credentials
      secret: rally-dockerhub-credentials
      pass-to-parent: false

- job:
    name: rally-database-migration
    parent: base
    nodeset: ubuntu-bionic
    run: tests/ci/playbooks/rally-database-migration-run.yaml
    timeout: 1800

- project:
    templates:
      - docs-on-readthedocs
    vars:
      rtd_webhook_id: "52691"
    check:
      jobs:
        - rally-tox-cover
        - rally-tox-docs
        - rally-tox-pep8
        - rally-tox-py36
        - rally-tox-py37
        - rally-tox-py38
        - rally-tox-samples
        - rally-tox-functional
        - rally-tox-functional-py38
        - rally-tox-self
        - rally-database-migration
        - rally-install-ubuntu-bionic
        - rally-install-centos-7
        - rally-install-centos-8
        - rally-docker-build:
            vars:
              docker_image_version: latest
    gate:
      jobs:
        - rally-tox-cover
        - rally-tox-docs
        - rally-tox-pep8
        - rally-tox-py36
        - rally-tox-py37
        - rally-tox-py38
        - rally-tox-functional
        - rally-tox-self
        - rally-database-migration
        - rally-install-ubuntu-bionic
        - rally-install-centos-7
        - rally-install-centos-8
    post:
      jobs:
        - rally-docker-build-and-push:
            vars:
              docker_image_version: latest
    release:
      jobs:
        - rally-docker-build-and-push
